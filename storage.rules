service firebase.storage {
  match /b/{bucket}/o {
    
    // ================================
    // PROFILE PHOTOS (PRIVATE)
    // ================================
   match /profile-photos/{userId}/{fileName} {
  // Profile photos are visible to all authenticated users
  allow read: if request.auth != null;
  
  // Only the owner can upload/delete
  allow write, delete: if request.auth != null && request.auth.uid == userId;
}
    // ================================
    // ID DOCUMENTS (STRICTLY PRIVATE)
    // ================================
    match /id-documents/{userId}/{fileName} {
      // Only owner may read
      allow read: if request.auth != null && request.auth.uid == userId;

      // Only owner may upload/delete
      allow write, delete: if request.auth != null && request.auth.uid == userId;
    }

    // ================================
    // PROVIDER DOCUMENTS (PRIVATE TO PROVIDER)
    // ================================
    match /provider-documents/{providerId}/{fileName} {
      // Only provider owner and admins can read
      allow read: if request.auth != null && (
          request.auth.uid == providerId ||
          request.auth.token.role == "admin" // optional admin access
      );

      // Only provider owner can upload/delete
      allow write, delete: if request.auth != null && request.auth.uid == providerId;
    }

    // ================================
    // PROPERTY IMAGES (PUBLIC LISTINGS)
    // ================================
    match /property-images/{propertyId}/{fileName} {
      // Public can view property images
      allow read: if true;

      // Only authenticated providers upload/delete
      allow write, delete: if request.auth != null;
    }

    // ================================
    // PLATFORM RESOURCES (ADMIN UPLOAD)
    // ================================
    match /platform-resources/{allPaths=**} {
      // All authenticated users can read
      allow read: if request.auth != null;

      // Only specific admin can upload/delete
      allow write, delete: if request.auth != null && 
        request.auth.token.email == "shampene@lebonconsulting.co.za";
    }

    // DEFAULT: DENY EVERYTHING ELSE
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
